{% extends 'base.html.twig' %}

{% block title %}QUIZ || QUESTION
{% endblock %}

{% block body %}
	<div id="quiz-container">


		{% block main %}
			<div class="fixed inset-0 bg-[#6E433C] bg-opacity-50 z-0 h-full w-full"></div>

			<!-- Section principale -->
			<section class="relative h-full max-w-full my-[39px] mx-[30px] p-2 bg-gradient-clair-orange border-t-[7px] border-l-[7px] border-r-[15px] border-b-[15px] border-primary rounded-[42px] overflow-hidden">

				{% block header %}
					{% include "header/headerQuestion.html.twig" %}
				{% endblock %}

				<form id="question-form">
					<input type="hidden" name="question_id" value="{{ question.id }}">
					<input type="hidden" name="index" value="{{ index }}">

					<div class="answers-grid">
						{% for answer in question.answers %}
							<div class="answer-container" data-answer-id="{{ answer.id }}">
								<input type="radio" name="answer" value="{{ answer.id }}" id="answer-{{ answer.id }}" hidden>
								<label for="answer-{{ answer.id }}">{{ answer.getAnswer }}</label>
							</div>
						{% endfor %}
					</div>

					<button type="submit" class="btn-custom4 btn">Valider</button>
				</form>


			{% endblock %}

			{% block footer %}
				{% include "footer/footerQuestion.html.twig" %}


			{% endblock %}

			{% block javascriptsQUIZ %}
				<script>
					document.addEventListener('DOMContentLoaded', function () {
const form = document.getElementById('question-form');
const answerContainers = document.querySelectorAll('.answer-container');

answerContainers.forEach(container => {
container.addEventListener('click', function () {
answerContainers.forEach(c => c.classList.remove('selected'));
container.classList.add('selected');
container.querySelector('input[type="radio"]').checked = true;
});
});

form.addEventListener('submit', function (event) {
event.preventDefault();
const formData = new FormData(form);
const questionId = formData.get('question_id');
const answerId = formData.get('answer');
const index = parseInt(formData.get('index')) + 1;

fetch(`/question/{{ quiz.Slug }}/check`, {
method: 'POST',
body: JSON.stringify(
{question_id: questionId, answer_id: answerId}
),
headers: {
'Content-Type': 'application/json'
}
}).then(response => response.json()).then(data => {
if (data.correct) {
document.querySelector (`.answer-container[data-answer-id="${answerId}"]`).classList.add('true');
} else {
document.querySelector (`.answer-container[data-answer-id="${answerId}"]`).classList.add('false');
}

setTimeout(() => {
if (index < {{ totalQuestions }}) {
fetch (`/question/{{ quiz.Slug }}/next?index=${index}`, {method: 'GET'}).then(response => response.text()).then(html => {
document.getElementById('quiz-container').innerHTML = html;
});
} else {
window.location.href = '/results';
}
}, 1000); 
});
});
				</script>
			{% endblock %}
		</section>

	</div>
{% endblock %}
